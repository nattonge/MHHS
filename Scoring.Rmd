---
title: "MHHS Scoring"
output: html_notebook
---

```{r load libraries}
library(psych)
library(tidyverse)
library(apaTables)
library(tableone)
library(dplyr)

```

```{r clean qualtrics headings}
#columnNames<-read.csv("../../01-RawData/MHHS_01182023.csv",header=FALSE)[1,]

#qual_data<-read.csv("../../01-RawData/MHHS_01182023.csv",header=FALSE,col.names = columnNames)[-c(1:3),]

# write a new version that can be reimported with the proper column classes
#write.csv(qual_data,"../../03-ProcessData/MHHS_01182023_cleanheader.csv",row.names=FALSE)
```

```{r load data}

mhhs_data<-read.csv("../../03-ProcessData/MHHS_01182023_cleanheader.csv")

```

```{r demographics}

# Know the range of possible answers for each factor and make sure to include NA

mhhs_demotbl<-mhhs_data %>% select(Race_Ethn2,BIC_1,LANG_1,EDUC_Par,EDUC_Self,GENDER,SEXOR,MILIT) %>% 
mutate(
Race_Ethn2=factor(Race_Ethn2,levels=c(NA,1,2,3,4,5,6,7),labels=c("Not answered","White","Black","Hispanic","Asian","AmerIndian","PacificIslander","Multiracial"),exclude=NULL), 
BIC_1=factor(BIC_1, levels=c(NA,0,1),labels=c("Not answered","NotBicultural","Bicultural"),exclude=NULL), 
LANG_1=factor(LANG_1, levels=c(NA,0,1),labels=c("Not Answered","English at Home","Additional Language at Home"),exclude=NULL), 
EDUC_Par=factor(EDUC_Par,levels=c(NA,1,2,3,4,5,6,7),labels = c("Not answered","<High School","High School","Some college","Associates","Bachelors","Masters","Doctoral/Professional"),exclude = NULL),
EDUC_Self=factor(EDUC_Self,levels=c(NA,1,2,3,4,5,6,7),labels = c("Not answered","<High School","High School","Some college","Associates","Bachelors","Masters","Doctoral/Professional"),exclude=NULL), 
GENDER=factor(GENDER,levels=c(NA,1,2,3,4,5,6,7),labels=c("Not answered","cis-woman","cis-man","trans woman","trans man","non-binary","self-id","prefer not to respond"),exclude=NULL), 
SexualOrientation=factor(SEXOR, levels=c(NA,1,2,3,4,5,6,7,8), labels = c("Not Answered","Straight","Bisexual","Gay","Lesbian","Queer","Questioning","Self-ID","Prefer not to respond"),exclude = NULL), 
MilitaryService=factor(MILIT,levels=c(NA,1,2,3,4,5,6,7,8),labels=c("Not answered","Never Served","Active Duty","National Guard","Military Spouse","Military Dependent","Veteran","Other","Prefer not to respond"),exclude=NULL)) %>% 
select(-MILIT,-SEXOR)

CreateTableOne(data=mhhs_demotbl)
```

To score the PROMIS_Global:
First check if survey coded Excellent as 1 or as 5. Qualtrics will often reverse them. Higher scores should reflect better functioning


PROMIS_Global1_1:PROMIS_Global1_7: Items rated from 5 (excellent) to 1 (Not at all) on original scale;

PROMIS_Global2_1: emotional problems; past 7 days; 5 (never) to 1 (always); 
PROMIS_Global2_2: fatigue; past 7 days

PROMIS_Global3_1: pain. 5=0, 4=1:3, 3=4:6, 2=7:9, 1=10

For scoring,  "2 questions were excluded from the calculation/evaluation as a result of the questionnaire development study: Global01 because of its statistical congruence with Global03. Global09 because of its approximately equal statistical correlation to physical and mental health."
```{r PROMIS}
promis_global<-mhhs_data %>% select(contains("PROMIS"))

#score items so that higher scores reflect better functioning 


# pain item: 5=0, 4=1:3, 3=4:6, 2=7:9, 1=10

promis_global<-promis_global %>% mutate(across(PROMIS_Global1_1:PROMIS_Global2_2,~6-.)) %>% 
  mutate(PROMIS_Global3_1=recode(PROMIS_Global3_1,`0`=5,`1`=4,`2`=4,`3`=4,`4`=3,`5`=3,`6`=3,`7`=2,`8`=2,`9`=2,`10`=1))

key_promis.list<-list(PH=c(3,6,7,8),MH=c(2,4,5,10))
key_promis<-make.keys(nvars=10,key_promis.list,item.labels = colnames(promis_global))
scales_promis<-scoreItems(key_promis,promis_global)
summary(scales_promis)

```

