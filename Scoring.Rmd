---
title: "MHHS Scoring"
output: html_notebook
---

```{r load libraries}
library(psych)
library(tidyverse)
library(apaTables)
library(tableone)
library(dplyr)

```

```{r clean qualtrics headings}
#columnNames<-read.csv("../../01-RawData/MHHS_01182023.csv",header=FALSE)[1,]

#qual_data<-read.csv("../../01-RawData/MHHS_01182023.csv",header=FALSE,col.names = columnNames)[-c(1:3),]

# write a new version that can be reimported with the proper column classes
#write.csv(qual_data,"../../03-ProcessData/MHHS_01182023_cleanheader.csv",row.names=FALSE)
```

```{r load data}

mhhs_data<-read.csv("../../03-ProcessData/MHHS_01182023_cleanheader.csv")

```

```{r demographics}

# Know the range of possible answers for each factor and make sure to include NA

mhhs_demotbl<-mhhs_data %>% select(Race_Ethn2,BIC_1,LANG_1,EDUC_Par,EDUC_Self,GENDER,SEXOR,MILIT) %>% 
mutate(
Race_Ethn2=factor(Race_Ethn2,levels=c(NA,1,2,3,4,5,6,7),labels=c("Not answered","White","Black","Hispanic","Asian","AmerIndian","PacificIslander","Multiracial"),exclude=NULL), 
BIC_1=factor(BIC_1, levels=c(NA,0,1),labels=c("Not answered","NotBicultural","Bicultural"),exclude=NULL), 
LANG_1=factor(LANG_1, levels=c(NA,0,1),labels=c("Not Answered","English at Home","Additional Language at Home"),exclude=NULL), 
EDUC_Par=factor(EDUC_Par,levels=c(NA,1,2,3,4,5,6,7),labels = c("Not answered","<High School","High School","Some college","Associates","Bachelors","Masters","Doctoral/Professional"),exclude = NULL),
EDUC_Self=factor(EDUC_Self,levels=c(NA,1,2,3,4,5,6,7),labels = c("Not answered","<High School","High School","Some college","Associates","Bachelors","Masters","Doctoral/Professional"),exclude=NULL), 
GENDER=factor(GENDER,levels=c(NA,1,2,3,4,5,6,7),labels=c("Not answered","cis-woman","cis-man","trans woman","trans man","non-binary","self-id","prefer not to respond"),exclude=NULL), 
SexualOrientation=factor(SEXOR, levels=c(NA,1,2,3,4,5,6,7,8), labels = c("Not Answered","Straight","Bisexual","Gay","Lesbian","Queer","Questioning","Self-ID","Prefer not to respond"),exclude = NULL), 
MilitaryService=factor(MILIT,levels=c(NA,1,2,3,4,5,6,7,8),labels=c("Not answered","Never Served","Active Duty","National Guard","Military Spouse","Military Dependent","Veteran","Other","Prefer not to respond"),exclude=NULL)) %>% 
select(-MILIT,-SEXOR)

CreateTableOne(data=mhhs_demotbl)
```

# PROMIS_Global v1.2
To score the PROMIS_Global:
First check if survey coded Excellent as 1 or as 5. Qualtrics will often reverse them. Higher scores should reflect better functioning


PROMIS_Global1_1:PROMIS_Global1_7: Items rated from 5 (excellent) to 1 (Not at all) on original scale;

PROMIS_Global2_1: emotional problems; past 7 days; 5 (never) to 1 (always); (global 10)
PROMIS_Global2_2: fatigue; past 7 days (global 08)

PROMIS_Global3_1: pain. 5=0, 4=1:3, 3=4:6, 2=7:9, 1=10

For scoring,  "2 questions were excluded from the calculation/evaluation as a result of the questionnaire development study: Global01 because of its statistical congruence with Global03. Global09 because of its approximately equal statistical correlation to physical and mental health."

The Global Physical Health score is generated by summing responses to
Global03 (PROMIS_Global1_3), Global06 (PROMIS_Global1_7), Global07rescored (PROMIS_Global3_1), and Global08rescored (PROMIS_Global2_2). The Global Mental Health score
is generated by summing responses to Global02 (PROMIS_Global1_2), Global04 (PROMIS_Global1_4), Global05(PROMIS_Global1_5), and Global10rescored (PROMIS_Global2_1)
```{r PROMIS}
promis_global<-mhhs_data %>% select(contains("PROMIS"))

#score items so that higher scores reflect better functioning 


# pain item: 5=0, 4=1:3, 3=4:6, 2=7:9, 1=10

promis_global<-promis_global %>% mutate(across(PROMIS_Global1_1:PROMIS_Global2_2,~6-.)) %>% 
  mutate(PROMIS_Global3_1=recode(PROMIS_Global3_1,`0`=5,`1`=4,`2`=4,`3`=4,`4`=3,`5`=3,`6`=3,`7`=2,`8`=2,`9`=2,`10`=1)) %>% 
  rowwise() %>%  mutate(PG_PhysHealth=sum(c(PROMIS_Global1_3,PROMIS_Global1_7,PROMIS_Global3_1,PROMIS_Global2_2)),PG_MentHealth=sum(c(PROMIS_Global1_2,PROMIS_Global1_4,PROMIS_Global1_5,PROMIS_Global2_1)))

key_promis.list<-list(PH=c("PROMIS_Global1_3","PROMIS_Global1_7","PROMIS_Global3_1","PROMIS_Global2_2"),MH=c("PROMIS_Global1_2","PROMIS_Global1_4","PROMIS_Global1_5","PROMIS_Global2_1"))
key_promis<-make.keys(nvars=10,key_promis.list,item.labels = colnames(promis_global))
scales_promis<-scoreItems(key_promis,promis_global)
summary(scales_promis)

```

GHSQL has one open-response item. This is not included in the summary score. Scoring also seems somewhat flexible and includes informal/formal; personal-emotional/suicide; help from anyone/Help from no-one
```{r GHSQL}
ghsql<-mhhs_data %>% select(contains("GHSQL"))

ghsql %>% rowwise() %>% mutate(General=sum(c(GHSQL_Pers_1:GHSQL_Pers_9),na.rm=TRUE))

ghsql<-ghsql %>% mutate(General=rowSums((select(ghsql,GHSQL_Pers_1:GHSQL_Pers_9,GHSQL_SUI_1:GHSQL_SUI_9)))) %>% 
 rowwise() %>%  
  mutate(Personal=sum(c_across(GHSQL_Pers_1:GHSQL_Pers_8)),
         Suicide=sum(c_across(GHSQL_SUI_1:GHSQL_SUI_8)),
         Informal_all=sum(c(GHSQL_Pers_1,GHSQL_SUI_1,GHSQL_Pers_2,GHSQL_SUI_2,GHSQL_Pers_3,GHSQL_SUI_3,GHSQL_Pers_4,GHSQL_SUI_4,GHSQL_Pers_1)),
         Formal_all=sum(c(GHSQL_Pers_5,GHSQL_SUI_5,GHSQL_Pers_6,GHSQL_SUI_6,GHSQL_Pers_7,GHSQL_SUI_7,GHSQL_Pers_8,GHSQL_SUI_8)),
         None_all=sum(c(GHSQL_Pers_9,GHSQL_SUI_9))) %>% 
  ungroup() %>% #remove rowwise grouping 
  mutate(Personal_z=scale(Personal),Suicide_z=scale(Suicide),Informal_all_z=scale(Informal_all),Formal_all_z=scale(Formal_all),None_all_z=scale(None_all))

```

```{r DASS21}
dass<-mhhs_data %>% select(contains("DASS"))


```

```{r ISMI 29}

```

```{r DDI}

```

```{r BFNE}

```

```{r TRS}

```

```{r TPS}

```

```{r EIS}

```

```{r EvIN}

```

