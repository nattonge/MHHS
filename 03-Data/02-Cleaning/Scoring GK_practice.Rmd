---
title: "MHHS Scoring"
output: html_notebook
author: gracie
---

```{r load libraries}
library(psych)
library(tidyverse)
library(apaTables)
library(tableone)
library(dplyr)
library(qualtRics)
library(kutils)


```

```{r clean qualtrics headings}
#columnNames<-read.csv("../../01-RawData/MHHS-1_09.30.23.csv",header=FALSE)[1,]

#qual_data<-read.csv("../../01-RawData/MHHS-1_09.30.23.csv",header=FALSE,col.names = columnNames)[-c(1:3),]

# write a new version that can be reimported with the proper column classes
#write.csv(qualdata,"../../04-ProcessData/MHHS-1_09.30.23_cleanheader.csv",row.names=FALSE)
```

```{r alternate qualtrics cleaning}
qualdata<-importQualtrics("../01-RawData/MHHS-1_09.30.23.csv",importidrow=3,namerow=1,questionrow=2)
```

```{r write csv with proper column classes}

write.csv(qualdata,"../04-ProcessedData/MHHS-1_09.30.23_cleanheader.csv",row.names=FALSE)
```

```{r load data}

mhhs_data<-read.csv("../04-ProcessedData/MHHS-1_09.30.23_cleanheader.csv")

```

```{r demographics}

# Know the range of possible answers for each factor and make sure to include NA

mhhs_demotbl<-mhhs_data %>% select(Race_Ethn2,BIC_1,LANG_1,EDUC_Par,EDUC_Self,GENDER,SEXOR,MILIT) %>% 
mutate(
Race_Ethn2=factor(Race_Ethn2,levels=c(NA,1,2,3,4,5,6,7),labels=c("Not answered","White","Black","Hispanic","Asian","AmerIndian","PacificIslander","Multiracial"),exclude=NULL), 
BIC_1=factor(BIC_1, levels=c(NA,0,1),labels=c("Not answered","NotBicultural","Bicultural"),exclude=NULL), 
LANG_1=factor(LANG_1, levels=c(NA,0,1),labels=c("Not Answered","English at Home","Additional Language at Home"),exclude=NULL), 
EDUC_Par=factor(EDUC_Par,levels=c(NA,1,2,3,4,5,6,7),labels = c("Not answered","<High School","High School","Some college","Associates","Bachelors","Masters","Doctoral/Professional"),exclude = NULL),
EDUC_Self=factor(EDUC_Self,levels=c(NA,1,2,3,4,5,6,7),labels = c("Not answered","<High School","High School","Some college","Associates","Bachelors","Masters","Doctoral/Professional"),exclude=NULL), 
GENDER=factor(GENDER,levels=c(NA,1,2,3,4,5,6,7),labels=c("Not answered","cis-woman","cis-man","trans woman","trans man","non-binary","self-id","prefer not to respond"),exclude=NULL), 
SexualOrientation=factor(SEXOR, levels=c(NA,1,2,3,4,5,6,7,8), labels = c("Not Answered","Straight","Bisexual","Gay","Lesbian","Queer","Questioning","Self-ID","Prefer not to respond"),exclude = NULL), 
MilitaryService=factor(MILIT,levels=c(NA,1,2,3,4,5,6,7,8),labels=c("Not answered","Never Served","Active Duty","National Guard","Military Spouse","Military Dependent","Veteran","Other","Prefer not to respond"),exclude=NULL)) %>% 
select(-MILIT,-SEXOR)

CreateTableOne(data=mhhs_demotbl)
```

# PROMIS_Global v1.2
To score the PROMIS_Global:
First check if survey coded Excellent as 1 or as 5. Qualtrics will often reverse them. Higher scores should reflect better functioning.

PROMIS_Global1_1:PROMIS_Global1_7: Items rated from 5 (excellent) to 1 (Not at all) on original scale;
PROMIS_Global1_1:PROMIS_Global1_7 are reversed from Qualtrics 1-5 defaults

PROMIS_Global2_1: emotional problems; past 7 days; 5 (never) to 1 (always); (global 10)
PROMIS_Global2_2: fatigue; past 7 days (global 08)

PROMIS_Global3_1: pain. 5=0, 4=1:3, 3=4:6, 2=7:9, 1=10

For scoring,  "2 questions were excluded from the calculation/evaluation as a result of the questionnaire development study: Global01 because of its statistical congruence with Global03. Global09r because of its approximately equal statistical correlation to physical and mental health."

The Global Physical Health score is generated by summing responses to
Global03 (PROMIS_Global1_3), Global06 (PROMIS_Global1_7), Global07rescored (PROMIS_Global3_1), and Global08rescored (PROMIS_Global2_2). The Global Mental Health score
is generated by summing responses to Global02 (PROMIS_Global1_2), Global04 (PROMIS_Global1_4), Global05(PROMIS_Global1_5), and Global10rescored (PROMIS_Global2_1)


#Attention check items
#AC1= "We care about the quality of our survey data. For us to get the most accurate measures of your opinions, it is important that you provide thoughtful answers to each question in this survey.
Do you commit to providing thoughtful answers to the questions in this survey?"
#AC2=These surveys can be very long and a little tiring. We want to ensure that you are still paying attention because we care about the quality of the data. If you are still paying attention and ready to move on, please click on the answer Agree.
#AC3=Based on the text you read above, what color have you been instructed to enter?
#AC4=Should we use your data?

```{r Attention Check}


```

```{r PROMIS}
promis_global<-mhhs_data %>% select(contains("PROMIS"))

#score items so that higher scores reflect better functioning 

# pain item: 5=0, 4=1:3, 3=4:6, 2=7:9, 1=10

# renaming the Promis to match the original measure

promis_global<-promis_global %>% rename_with(~sprintf("PROMIS_Global0%d",1:5),.cols=c(PROMIS_Global1_1:PROMIS_Global1_5)) %>%  rename(PROMIS_Global09=PROMIS_Global1_6,PROMIS_Global06=PROMIS_Global1_7, PROMIS_Global10=PROMIS_Global2_1, PROMIS_Global08=PROMIS_Global2_2,PROMIS_Global07=PROMIS_Global3_1)%>% mutate(across(c(PROMIS_Global01:PROMIS_Global08),~6-.)) %>% 
  mutate(PROMIS_Global07=recode(PROMIS_Global07,`0`=5,`1`=4,`2`=4,`3`=4,`4`=3,`5`=3,`6`=3,`7`=2,`8`=2,`9`=2,`10`=1))%>% 
  rowwise() %>%  mutate(PG_PhysHealth=sum(c(PROMIS_Global03,PROMIS_Global06,PROMIS_Global07,PROMIS_Global08)),PG_MentHealth=sum(c(PROMIS_Global02,PROMIS_Global04,PROMIS_Global05,PROMIS_Global10))) %>% ungroup()

promis_global_scoring<-promis_global %>% select(-PROMIS_Global01, -PROMIS_Global09,-PG_PhysHealth,-PG_MentHealth)

key_promis.list<-list(PH=c("PROMIS_Global03","PROMIS_Global06","PROMIS_Global07","PROMIS_Global08"),MH=c("PROMIS_Global02","PROMIS_Global04","PROMIS_Global05","PROMIS_Global10"))

key_promis<-make.keys(nvars=8,key_promis.list,item.labels = colnames(promis_global_scoring))
scales_promis<-scoreItems(key_promis,promis_global_scoring)
summary(scales_promis)

```

# GHSQL
GHSQL has one open-response item. This is not included in the summary score. Scoring also seems somewhat flexible and includes informal/formal; personal-emotional/suicide; help from anyone/Help from no-one.

Range 1-7 (Extremely unlikely to Extremely Likely)

```{r GHSQL}
ghsql<-mhhs_data %>% select(contains("GHSQL"))

ghsql<-ghsql %>% mutate(General=rowSums((select(ghsql,GHSQL_Pers_1:GHSQL_Pers_9,GHSQL_SUI_1:GHSQL_SUI_9)))) %>% 
 rowwise() %>%  
  mutate(Personal=sum(c_across(GHSQL_Pers_1:GHSQL_Pers_8)),
         Suicide=sum(c_across(GHSQL_SUI_1:GHSQL_SUI_8)),
         Informal_all=sum(c(GHSQL_Pers_1,GHSQL_SUI_1,GHSQL_Pers_2,GHSQL_SUI_2,GHSQL_Pers_3,GHSQL_SUI_3,GHSQL_Pers_4,GHSQL_SUI_4)),
         Formal_all=sum(c(GHSQL_Pers_5,GHSQL_SUI_5,GHSQL_Pers_6,GHSQL_SUI_6,GHSQL_Pers_7,GHSQL_SUI_7,GHSQL_Pers_8,GHSQL_SUI_8)),
         None_all=sum(c(GHSQL_Pers_9,GHSQL_SUI_9))) %>% 
  ungroup() %>% #remove rowwise grouping 
  mutate(Personal_z=scale(Personal),Suicide_z=scale(Suicide),Informal_all_z=scale(Informal_all),Formal_all_z=scale(Formal_all),None_all_z=scale(None_all))

#make a dataframe with only the items to be scored/that need reliability
ghsql_scoring<-ghsql %>% dplyr::select(1:9,12:20)
key_ghsql.list<-list(General=c(1:18),Personal=c(1:9),Suicide=c(10:18),Formal=c(5,14,6,15,7,16,8,17),Informal=c(1,10,2,11,3,12,4,13))
key_ghsql<-make.keys(18,key_ghsql.list,colnames(ghsql_scoring))

scales_ghsql<-scoreItems(key_ghsql.list,ghsql_scoring)
summary(scales_ghsql)

#histogram to explore the range 
ghsql %>% select(GHSQL_Pers_1:GHSQL_Pers_9) %>% gather() %>% ggplot(aes(y=value,x=key)) + geom_boxplot() + scale_x_discrete(labels=c("Intimate partner", "Friend","Parent","Other relative","MHP","Phone helpline","Doctor","Minister","Not seek help"))+ theme(axis.text.x = element_text(angle=90))

ghsql %>% select(GHSQL_SUI_1:GHSQL_SUI_9) %>% gather() %>% ggplot(aes(y=value,x=key)) + geom_boxplot() + scale_x_discrete(labels=c("Intimate partner", "Friend","Parent","Other relative","MHP","Phone helpline","Doctor","Minister","Not seek help"))+ theme(axis.text.x = element_text(angle=90))

ghsql %>% select(Informal_all_z,Formal_all_z,None_all_z) %>% gather() %>% ggplot(aes(y=value,x=key)) + geom_boxplot() + scale_x_discrete(labels=c("Informal (Pers + Sui)","Formal (Pers + Sui)","None (Pers + Sui)"))+ theme(axis.text.x = element_text(angle=90))

ghsql %>% select(GHSQL_Pers_10_TEXT,GHSQL_SUI_10_TEXT) %>% filter(GHSQL_Pers_10_TEXT!=""|GHSQL_SUI_10_TEXT!="")

```

# DASS21

Stress items are 1, 6, 8, 11, 12, 14, 18
Anxiety items are 2, 4, 7, 9, 15, 19, 20,  
Depression items are 3, 5, 10, 13, 16, 17, 21 

The depression scale assesses dysphoria, hopelessness, devaluation of life, self-deprecation, lack of interest / involvement, anhedonia and inertia. 

The anxiety scale assesses autonomic arousal, skeletal muscle effects, situational anxiety, and subjective experience of anxious affect. 
The stress scale is sensitive to levels of chronic nonspecific arousal. It assesses difficulty relaxing, nervous arousal, and being easily upset / agitated, irritable / over-reactive and impatient. 

Scores for depression, anxiety and stress are calculated by summing the scores for the relevant items

Scores on the DASS-21 will need to be multiplied by 2 to calculate the final score and stay equivalent with DASS-42.
```{r DASS21}
dass<-mhhs_data %>% select(contains("DASS"))

dass<-dass %>% mutate(Dass21_Total=rowSums((select(dass,DASS21_1:DASS21_21)))*2) %>% 
 rowwise() %>%  
  mutate(Dass21_Stress=sum(DASS21_1,DASS21_6, DASS21_8,DASS21_11,DASS21_12,DASS21_14,DASS21_18,na.rm = T),
         Dass21_Anxiety=sum(DASS21_2,DASS21_4,DASS21_7,DASS21_9,DASS21_15,DASS21_19,DASS21_20, na.rm=T),
         Dass21_Depression=sum(DASS21_3,DASS21_5,DASS21_10,DASS21_13,DASS21_16,DASS21_17,DASS21_21, na.rm=T)) %>% 
  ungroup() %>%
  mutate(Dass21_Stress_z=scale(.,)) %>%
  mutate(Dep_cuts=case_when(Dass21_Depression<10~"Normal",
                                   Dass21_Depression<14~"Mild",
                                   Dass21_Depression<21~"Moderate",
                                   Dass21_Depression<28~"Severe",
                                   Dass21_Depression>27~"Extremely_Severe"),
                Anx_cuts=case_when(Dass21_Anxiety<8~"Normal",
                                   Dass21_Anxiety<10~"Mild",
                                   Dass21_Anxiety<15~"Moderate",
                                   Dass21_Anxiety<20~"Severe",
                                   Dass21_Anxiety>19~"Extremely_Severe"),
                Stress_cuts=case_when(Dass21_Stress<15~"Normal",
                                   Dass21_Stress<19~"Mild",
                                   Dass21_Stress<26~"Moderate",
                                   Dass21_Stress<34~"Severe",
                                   Dass21_Stress>33~"Extremely_Severe"))


#make a dataframe with only the items to be scored/that need reliability
dass_scoring<-dass %>% dplyr::select(DASS21_1:DASS21_21)
key_dass.list<-list(Stress=c(1,6,8,11,12,14,18),Anxiety=c(2,4,7,9,15,19,20),Depression=c(3,5,10,13,16,17,21))

key_dass<-make.keys(21,key_dass.list,colnames(dass_scoring))

scales_dass<-scoreItems(key_dass.list,dass_scoring)
summary(scales_dass)

#histogram to explore the range 
dass %>% select(Dass21_Stress,Dass21_Anxiety, Dass21_Depression) %>% gather() %>% ggplot(aes(y=value,x=key)) + geom_boxplot() + scale_x_discrete(labels=c("Stress","Anxiety","Depression"))+ theme(axis.text.x = element_text(angle=90))

#scatterplot to color the cutoffs
dass_severity<-dass %>%  select(Dass21_Stress,Dass21_Anxiety, Dass21_Depression) %>% 
pivot_longer(cols=starts_with("Dass21"),names_to = "Subscale",values_to = "score") %>%   mutate(Cuts=case_when((Subscale=="Dass21_Depression" & score<10) ~"Normal",
                       (Subscale== "Dass21_Depression"& score<14)~"Mild",
                       (Subscale== "Dass21_Depression"& score<21)~"Moderate",
                       (Subscale== "Dass21_Depression"& score<28)~"Severe",
                       (Subscale== "Dass21_Depression"& score>27)~"Extremely_Severe",
                       (Subscale=="Dass21_Anxiety"& score<8)~"Normal",
                      (Subscale== "Dass21_Anxiety"& score<10)~"Mild",
                      (Subscale== "Dass21_Anxiety"& score<15)~"Moderate",
                      (Subscale== "Dass21_Anxiety"& score<20)~"Severe",
                      (Subscale== "Dass21_Anxiety"& score>19)~"Extremely_Severe",
                      (Subscale=="Dass21_Stress"& score<15)~"Normal",
                      (Subscale=="Dass21_Stress"& score<19)~"Mild",
                      (Subscale=="Dass21_Stress"& score<26)~"Moderate",
                      (Subscale== "Dass21_Stress"& score<34)~"Severe",
                      (Subscale== "Dass21_Stress"& score>33)~"Extremely_Severe"))

  
#severity histogram colored by severity
dass_scatter %>% ggplot(aes(score,fill=Subscale,group=Subscale))+geom_bar()

#jitter plot colored by severity
dass_scatter %>% ggplot(aes(x=Subscale,y=score,colour=Cuts))+geom_jitter()+theme_classic()+scale_color_brewer(palette = "Set1")
```
# ISMI29
29-item measure assessing self stigma of mental illness. Includes subscales: alienation, stereotype endorsement, discrimination experience, social withdrawal, stigma resistance. Scored from 1-4. The entire Stigma resistance subscale is reverse scored.

Traditional scoring is dichotomous and uses means. 

```{r ISMI 29}
ismi<-mhhs_data %>% select(contains("ISMI"))

ismi<-ismi %>% rowwise() %>%  
  mutate(ISMI_Alientation=sum(ISMI29_1,ISMI29_5,ISMI29_8,ISMI29_16,ISMI29_17,ISMI29_21),
         ISMI_Stere=sum(ISMI29_2, ISMI29_6,ISMI29_10,ISMI29_18,ISMI29_19,ISMI29_23,ISMI29_29),
         ISMI_Discr=sum(ISMI29_3,ISMI29_15,ISMI29_22,ISMI29_25,ISMI29_28),
    ISMI_Withdrawal=sum(ISMI29_4,ISMI29_9,ISMI29_11,ISMI29_12,ISMI29_13,ISMI29_20)) %>% 
      mutate(ISMI29_7=recode(ISMI29_7,`1`=4,`2`=3,`3`=2,`4`=1),
            ISMI29_14=recode(ISMI29_14,`1`=4,`2`=3,`3`=2,`4`=1),
         ISMI29_24=recode(ISMI29_24,`1`=4,`2`=3,`3`=2,`4`=1),
          ISMI29_26=recode(ISMI29_26,`1`=4,`2`=3,`3`=2,`4`=1),
         ISMI29_27=recode(ISMI29_27,`1`=4,`2`=3,`3`=2,`4`=1)) %>%  
      mutate(ISMI_Stigmar=sum(ISMI29_7,ISMI29_14,ISMI29_24,ISMI29_26,ISMI29_27)) %>% 
  ungroup()


#make a dataframe with only the items to be scored/that need reliability
ismi_scoring<-ismi %>% dplyr::select(ISMI29_1:ISMI29_29)
key_ismi.list<-list(Alien=c(1,5,8,16,17,21),Stereotype=c(2,6,10,18,19,23,29),Discrimination=c(3,15,22,25,28),Withdrawal=c(4,9,11,12,13,20),StigmaR=c(7,14,24,26,27))

key_ismi<-make.keys(29,key_ismi.list,colnames(ismi_scoring))

scales_ismi<-scoreItems(key_ismi.list,ismi_scoring)
summary(scales_ismi)

ismi$ISMI29_14
cor(ismi$ISMI_Stigmar,ismi$ISMI_Alientation,use="complete.obs")

ismi %>% select(ISMI_Alientation,ISMI_Stere,ISMI_Discr,ISMI_Withdrawal,ISMI_Stigmar) %>% gather() %>%  ggplot(aes(y=value,x=key,color=value))+geom_boxplot()+geom_jitter()

```
For some reason, the rescored stigma resistance is a negative correlation

# Distress Disclosure Index

Reverse score items 2, 4, 5, 8, 9, 10. Then sum the 12 items. Higher scores indicate a higher tendency to disclose distress, lower scores indicate greater concealment of distress.
```{r DDI}

ddi<-mhhs_data %>% select(contains("DDI"))

ddi<-ddi %>% mutate(across(c(DDI_2,DDI_4,DDI_5,DDI_8,DDI_9,DDI_10),~6-.)) %>%
  rowwise() %>% mutate(DDI_Total=sum(c_across(DDI_1:DDI_12))) %>% 
  ungroup()

ddi_scoring<-ddi %>% dplyr::select(DDI_1:DDI_12)

key_ddi.list<-list(Total=c(1:12))
key_ddi<-make.keys(12,key_ddi.list,colnames(ddi_scoring))

scales_ddi<-scoreItems(key_ddi.list,ddi_scoring)
summary(scales_ddi)

ddi %>% select(DDI_Total) %>% gather() %>%  ggplot(aes(y=value,x=key,color=value))+geom_boxplot()+geom_jitter()
ddi %>% select(DDI_Total) %>% add_column(ghsql %>% select(Personal,Suicide,General,None_all)) %>% cor.plot(.)



# checking the correlations ot ensure they make sense
cor.test(ddi$DDI_Total,ghsql$General)
cor.test(ddi$DDI_Total,ghsql$Personal)
cor.test(ddi$DDI_Total,ghsql$Suicide)
cor.test(ddi$DDI_Total,ghsql$None_all)

```

#BFNE

Consists of 12 items, range 1-5
Items 2, 4, 7, and 10 are reverse scored
Forward= c('BFNE_1', 'BFNE_3', 'BFNE_5', 'BFNE_6',  'BFNE_8', 'BFNE_9', 'BFNE_11', 'BFNE_12'), Reverse= c('BFNE_2', 'BFNE_4', 'BFNE_7', 'BFNE_10')
```{r BFNE}
bfne<-mhhs_data %>% select(contains("bfne"))

bfne<-bfne %>% mutate(across(c(BFNE_2,BFNE_4,BFNE_7,BFNE_10),~6-.))
                      
bfne_scoring<-bfne %>% dplyr::select(BFNE_1:BFNE_12)
key_bfne.list<-list(Total=c(1:12))
key_bfne<-make.keys(12,key_bfne.list,colnames(bfne_scoring))

scales_bfne<-scoreItems(key_bfne.list,bfne_scoring)
summary(scales_bfne)

```

# Trust respect scale
8 questions 1-strongly disagree; 7 - strongly agree
2,3,5,6 reverse-scored

```{r TRS}
trs<-mhhs_data %>% select(contains("trs"))

trs<-trs %>% mutate(across(c(TRS_2,TRS_3,TRS_5,TRS_6),~8-.))

trs_scoring<-trs %>% dplyr::select(TRS_1:TRS_8)
key_trs.list<-list(Total=c(1:8))
key_trs<-make.keys(8,key_trs.list,colnames(trs_scoring))

scales_trs<-scoreItems(key_trs.list,trs_scoring)
summary(scales_trs)

trs %>% select(TRS_1:TRS_8) %>% gather() %>%  ggplot(aes(y=value,x=key,color=value))+geom_boxplot()+geom_jitter()


```

# Trust in Physician Scale

1 (strongly disagree)- 5 (strongly agree)
11 items, unweighted mean of response
reverse scored - 1, 5, 7, 11
original scale alpha = .90

Summary score of medical skepticism was obtained by taking the unweighted mean of the four items. 
```{r TPS}

tps<-mhhs_data %>% select(contains("tps"))

tps<-tps %>% mutate(across(c(TPS_1,TPS_5,TPS_7,TPS_11),~6-.)) %>% 
  rowwise() %>% mutate(TPS_Tot=sum(c_across(TPS_1:TPS_11))) %>% 
  ungroup()

#selecting the write-ins
tps %>% filter(TPS_O!="") %>% select(TPS_O)

tps_scoring<-tps %>% dplyr::select(TPS_1:TPS_11)
key_tps.list<-list(Total=c(1:11))
key_tps<-make.keys(11,key_tps.list,colnames(tps_scoring))

scales_tps<-scoreItems(key_tps.list,tps_scoring)
summary(scales_tps)

tps %>% select(TPS_1:TPS_11) %>% gather() %>%  ggplot(aes(y=value,x=key,color=value))+geom_boxplot()+geom_jitter()



```
# Ethnic Identity Scale

reverse score 4,5,8

```{r EIS}
eis<-mhhs_data %>% select(contains("eis"))

# identity questions
eis_id<-eis %>% select(EIS_RE1:EIS_HORIGIN_3_TEXT)
eis_resp<-eis %>% select(!EIS_RE1:EIS_HORIGIN_3_TEXT)

# observe the write-ins
eis_id %>% filter(EIS_RE1_7_TEXT!="") %>% select(EIS_RE1_7_TEXT)
eis_id %>% filter(EIS_HORIGIN_3_TEXT!="") %>% select(EIS_HORIGIN_3_TEXT)

# selecting responses only
eis_resp<-eis_resp %>% mutate(across(c(EIS_Ethni_4,EIS_Ethni_5,EIS_Ethni_8),~5-.)) %>% 
  rowwise() %>% mutate(EIS_Tot=sum(c_across(EIS_Ethni_1:EIS_Ethni_9))) %>% 
  ungroup()

eis_scoring<-eis_resp %>% dplyr::select(EIS_Ethni_1:EIS_Ethni_9)
key_eis.list<-list(Total=c(1:9))
key_eis<-make.keys(9,key_eis.list,colnames(eis_scoring))

scales_eis<-scoreItems(key_eis.list,eis_scoring)
summary(scales_eis)

eis_resp %>% select(EIS_Ethni_1:EIS_Ethni_9) %>% gather() %>%  ggplot(aes(y=value,x=key,color=value))+geom_boxplot()+geom_jitter()



```

# Everyday Iniquity - Content

There is also another item: EvIn_2
 What do you think is the main reason for these experiences? and a write-in option if someone selects "other" for EvIn_2
 


```{r EvIn}

EvIn<-mhhs_data %>% select(contains("EvIn"))

                      
evin_scoring<-EvIn %>% dplyr::select(EvIn_1_1:EvIn_1_5)
key_evin.list<-list(Total=c(1:5))
key_evin<-make.keys(5,key_evin.list,colnames(evin_scoring))

scales_evin<-scoreItems(key_evin.list,evin_scoring)
summary(scales_evin)

```
#Bicultural facility scale 

#need scoring instructions for this --> how to handle that last item only there for people speaking multiple languages at home

```{r}
bicf<-mhhs_data %>% select(contains("bicf"))



```

# Bicultural identity integration scale

#how to handle items that only appear for part of sample
```{r}
bicii<-mhhs_data %>% select(contains("bicii"))



```

# Tosca-3

SHAME =  1a + 2b + 3a + 4c + 5a + 6b + 7d + 8b +  9b + 10a + 11c OR items 1+6+9+15+17+22+28+30+34+37+43
GUILT =  1c + 2a + 3c + 4d + 5d + 6d + 7c + 8d + 9c + 10c + 11b OR items 3+5+11+16+20+24+27+32+35+39+42
EXTERNALIZATION = 1d+2c+3b+4a+5b++6a+7b++8c+9a+10b+11d OR items 4+7+10+13+18+21+26+31+33+38+44
DETACH =  1b + 2d + 3d +   4b +  5c+6c+7a+8a+9d+10d+11a OR items 2+8+12+14+17+23+25+29+36+40+41 

scored on 1-5 likert; no reverse scored items

```{r TOSCA-3}
tosca<-mhhs_data %>% select(contains("tosca"))

#make a dataframe with only the items to be scored/that need reliability
tosca_scoring<-tosca %>% dplyr::select(TOSCA3_.1_1:TOSCA3_11_4)
key_tosca.list<-list(Shame=c(1,6,9,15,17,22,28,30,34,37,43), Guilt=c(3,5,11,16,20,24,27,32,35,39,42), Externalization=c(4,7,10,13,18,21,26,31,33,38,44),Detach=c(2,8,12,14,17,23,25,29,36,40,41))

key_tosca<-make.keys(44,key_tosca.list,colnames(tosca_scoring))

scales_tosca<-scoreItems(key_tosca.list,tosca_scoring)
```


```{r TOSCA-3}
summary(scales_tosca)

```

# Relationship assessment scale - friend or intimate partner

#items 2, 4, 7 reverse scored

```{r}

ras_fri<-mhhs_data %>% select(contains("RAS_friend"))

ras_fri<-ras_fri %>% mutate(across(c(RAS_Friend_IP_2,RAS_Friend_IP_4,RAS_Friend_IP_7),~6-.))

ras_fri_scoring<-ras_fri %>% dplyr::select(RAS_Friend_IP_1:RAS_Friend_IP_7)
key_ras_fri.list<-list(Total=c(1:7))
key_ras_fri<-make.keys(7,key_ras_fri.list,colnames(ras_fri_scoring))

scales_ras_fri<-scoreItems(key_ras_fri.list,ras_fri_scoring)
summary(scales_ras_fri)

ras_fri %>% select(RAS_Friend_IP_1:RAS_Friend_IP_7) %>% gather() %>%  ggplot(aes(y=value,x=key,color=value))+geom_boxplot()+geom_jitter()


```

# Relationship assessment scale - family member

#items 2, 4, 7 reverse scored


```{r}
ras_fam<-mhhs_data %>% select(contains("RAS_fam"))


ras_fam<-ras_fam %>% mutate(across(c(RAS_fam_2,RAS_fam_4,RAS_fam_7),~6-.))

ras_fam_scoring<-ras_fam %>% dplyr::select(RAS_fam_1:RAS_fam_7)
key_ras_fam.list<-list(Total=c(1:7))
key_ras_fam<-make.keys(7,key_ras_fam.list,colnames(ras_fam_scoring))

scales_ras_fam<-scoreItems(key_ras_fam.list,ras_fam_scoring)
summary(scales_ras_fam)

ras_fam %>% select(RAS_fam_1:RAS_fam_7) %>% gather() %>%  ggplot(aes(y=value,x=key,color=value))+geom_boxplot()+geom_jitter()
```


# IPIP specific trust - doctor

#reverse score items 4, 5, 6
```{r}
trust_prof <-mhhs_data %>% select(contains("ipip_prof"))

trust_prof<-trust_prof %>% mutate(across(c(Trust_ipip_prof_4,Trust_ipip_prof_5, Trust_ipip_prof_6),~6-.)) %>% 
  rowwise() %>% mutate(trust_prof_Tot=sum(c_across(Trust_ipip_prof_1:Trust_ipip_prof_6))) %>% 
  ungroup()
                      
trust_prof_scoring<-trust_prof %>% dplyr::select(Trust_ipip_prof_1:Trust_ipip_prof_6)
key_trust_prof.list<-list(Total=c(1:6))
key_trust_prof<-make.keys(6,key_trust_prof.list,colnames(trust_prof_scoring))

scales_trust_prof<-scoreItems(key_trust_prof.list,trust_prof_scoring)
summary(scales_trust_prof)

```

#IPIP specific trust - family

#reverse score items 4, 5, 6
```{r}

trust_fam <-mhhs_data %>% select(contains("IPIP_Family")) 

trust_fam <-trust_fam %>% mutate(across(c(Trust_IPIP_Family_4,Trust_IPIP_Family_5, Trust_IPIP_Family_6),~6-.)) %>% 
  rowwise() %>% mutate(trust_fam_Tot=sum(c_across(Trust_IPIP_Family_1:Trust_IPIP_Family_6))) %>% 
  ungroup()
                      
trust_fam_scoring<-trust_fam %>% dplyr::select(Trust_IPIP_Family_1:Trust_IPIP_Family_6)
key_trust_fam.list<-list(Total=c(1:6))
key_trust_fam<-make.keys(6,key_trust_fam.list,colnames(trust_fam_scoring))

scales_trust_fam<-scoreItems(key_trust_fam.list,trust_fam_scoring)
summary(scales_trust_fam)

```

#IPIP specific trust - friend
#reverse score items 4, 5, 6
```{r}

trust_friend <-mhhs_data %>% select(contains("ipip_friend"))

trust_friend<-trust_friend %>% mutate(across(c(Trust_ipip_friend_4,Trust_ipip_friend_5, Trust_ipip_friend_6),~6-.)) %>% 
  rowwise() %>% mutate(trust_friend_Tot=sum(c_across(Trust_ipip_friend_1:Trust_ipip_friend_6))) %>% 
  ungroup()
                      
trust_friend_scoring<-trust_friend %>% dplyr::select(Trust_ipip_friend_1:Trust_ipip_friend_6)
key_trust_friend.list<-list(Total=c(1:6))
key_trust_friend<-make.keys(6,key_trust_friend.list,colnames(trust_friend_scoring))

scales_trust_friend<-scoreItems(key_trust_friend.list,trust_friend_scoring)
summary(scales_trust_friend)

```


# Self-concealment

```{r self concealment scale}

scs<-mhhs_data %>% select(contains("SCS"))

                      
scs_scoring<-scs %>% dplyr::select(SCS_1:SCS_10)
key_scs.list<-list(Total=c(1:10))
key_scs<-make.keys(10,key_scs.list,colnames(scs_scoring))

scales_scs<-scoreItems(key_scs.list,scs_scoring)
summary(scales_scs)

```

# IPIP 47

We administered the full 47-item version starting Summer 2023. 

Five factors: E = 1, 6(R), 11, 16(R). N = 4, 9(R), 14, 19(R). A = 2, 7(R), 12, 17(R). C = 3, 8, 13, 18(R). O = 5, 10(R), 15(R), 20(R).

Facets: A1 (trust) = 22, 27(R), 34, 43. A6 (sympathy) = 7, 25, 32, 40. C1 (Self-efficacy) = 26, 31, 38, 44. C4 (Achievement striving) = 33(R), 37(R), 42, 45. C5 (Self-Discipline) = 23, 29, 36, 46. N2 (Anger) = 30, 39(R), 41, 47. N5 (Immoderation) = 21(R), 24(R), 28(R), 35. 


```{r IPIP-47}

ipip_47<-mhhs_data %>% select(contains("IPIP_47"))

ipip_47<-ipip_47 %>% rowwise() %>%  
  mutate(ipip47_extraversion=sum(IPIP47_1, IPIP47_6, IPIP47_11, IPIP47_16), ipip47_neuroticism=sum(IPIP47_1, IPIP47_9_, IPIP47_14, IPIP47_19),
         ipip47_agreeableness=sum(IPIP47_2, IPIP47_7, IPIP47_12, IPIP47_17),
    ipip47_conscientiousness=sum(IPIP47_3, IPIP47_8, IPIP47_13, IPIP47_18), 
 ipip47_openness=sum(IPIP47_5, IPIP47_10, IPIP47_20), 
ipip47_trust=sum(IPIP47_22, IPIP47_27, IPIP47_34, IPIP47_43), ipip47_sympathy=sum(IPIP47_7, IPIP47_25, IPIP47_32, IPIP47_40), ipip47_self_efficacy=sum(IPIP47_26, IPIP47_31, IPIP47_38, IPIP47_44), ipip47_achievement=sum(IPIP47_33, IPIP12_37, IPIP47_42, IPIP47_45), ipip47_self_discipline=sum(IPIP47_23, IPIP47_29, IPIP47_36, IPIP47_46), ipip_anger=sum(IPIP47_30, IPIP47_39, IPIP47_41, IPIP47_47), ipip47_immoderation=sum(IPIP47_21, IPIP47_24, IPIP47_28, IPIP47_35)) %>% 
  
  mutate(IPIP47_6=recode(IPIP47_6,`1`=5,`2`=4,`4`=2, `5`=1),
            IPIP47_16=recode(IPIP47_16,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_9=recode(IPIP47_9,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_19=recode(IPIP47_19,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_7=recode(IPIP47_7,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_17=recode(IPIP47_17,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_18=recode(IPIP47_18,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_10=recode(IPIP47_10,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_15=recode(IPIP47_15,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_20=recode(IPIP47_20,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_27=recode(IPIP47_27,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_33=recode(IPIP47_33,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_37=recode(IPIP47_37,`1`=5,`2`=4,`4`=2, `5`=1), IPIP47_39=recode(IPIP47_39,`1`=5,`2`=4,`4`=2, `5`=1), 
IPIP47_21=recode(IPIP47_21,`1`=5,`2`=4,`4`=2, `5`=1), 
IPIP47_24=recode(IPIP47_24,`1`=5,`2`=4,`4`=2, `5`=1),
IPIP47_28=recode(IPIP47_28,`1`=5,`2`=4,`4`=2, `5`=1)) %>%
     
ungroup()

#make a dataframe with only the items to be scored/that need reliability
ipip47_scoring<-ipip_47 %>% dplyr::select(IPIP47_1:IPIP47_47)
key_ipip47.list<-list(Extraversion=c(1,6,11,16),neuroticism=c(4, 9, 14, 19),Agreeableness=c(2,7,12,17),Conscientiousness=c(3,8,13,18),Openness=c(5,10,20),Trust=c(22,27,34,43),Sympathy=c(7,25,32,40),Self-efficacy=c(26,31,38,44),Achievement-striving=c(33,37,42,45),Self-discipline=c(23,29,36,46),Anger=c(30,39,41,47),Immoderation=c(21,24,2,35))

key_ipip47<-make.keys(47,key_ipip47.list,colnames(ipip47_scoring))

scales_ipip47<-scoreItems(key_ipip47.list,ipip47_scoring)
summary(scales_ipip47)

ipip_47$IPIP47
cor(ipip_47$ipip47_extraversion$ipip47_openness,use="complete.obs")

ipip_47 %>% select(ipip47_extraversion, ipip47_neuroticism, ipip47_agreeableness, ipip47_conscientiousness, ipip47_openness, ipip47_trust, ipip47_achievement, ipip47_immoderation) %>% gather() %>%  ggplot(aes(y=value,x=key,color=value))+geom_boxplot()+geom_jitter()
  
```

#mini IPIP 12

We administered the 12-item version in Fall 2022
 subscales are agreeableness (1,2,3,4), trust (5,7,9,11), self-efficacy (6,8,10,12)


```{r mini IPIP 12}
ipip12<-mhhs_data %>% select(contains("mini"))

ipip12<- ipip12 %>% mutate(across(c(miniIPIP12_2, miniIPIP12_4, miniIPIP12_7),~6-.)) %>%

ungroup()

#make a dataframe with only the items to be scored/that need reliability
ipip12_scoring<-ipip12 %>% dplyr::select(miniIPIP12_1:miniIPIP12_12)
key_ipip12.list<-list(Trust_12=c(5, 7, 9, 11), Agreeableness_12=c(1,2,3,4), Self_efficacy_12=c(6,8,10,12))

key_ipip12<-make.keys(12,key_ipip12.list,colnames(ipip12_scoring))

scales_ipip12<-scoreItems(key_ipip12.list,ipip12_scoring)
summary(scales_ipip12)


```

SAFE

```{r SAFE}

safe<-mhhs_data %>% select(contains("SAFE"))
                      
safe_scoring<-safe %>% dplyr::select(SAFE_1:SAFE_32)
key_safe.list<-list(Total=c(1:32))
key_safe<-make.keys(32,key_safe.list,colnames(safe_scoring))

scales_safe<-scoreItems(key_safe.list,safe_scoring)
summary(scales_safe)

```